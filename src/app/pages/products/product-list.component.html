<div class="min-h-screen bg-gray-50">
  <!-- Header Section -->
  <div class="bg-white shadow-sm border-b">
    <div class="container-custom py-6">
      <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
        <div>
          <h1 class="text-3xl font-bold text-gray-900">Products</h1>
          <p class="text-gray-600 mt-1">Discover our amazing collection of products</p>
        </div>
        <div class="flex items-center gap-4">
          <p-dropdown 
            [options]="sortOptions" 
            [(ngModel)]="selectedSort" 
            optionLabel="label" 
            optionValue="value"
            placeholder="Sort by"
            (onChange)="onSortChange()"
            styleClass="w-48">
          </p-dropdown>
          <p-button 
            icon="pi pi-filter" 
            label="Filters" 
            (onClick)="toggleFilters()"
            [outlined]="true"
            styleClass="p-button-sm">
          </p-button>
        </div>
      </div>
    </div>
  </div>

  <div class="container-custom py-8">
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
      <!-- Filters Sidebar -->
      <div class="lg:col-span-1" [class.hidden]="!showFilters" [class.lg:block]="true">
        <div class="bg-white rounded-lg shadow-sm border p-6 sticky top-4">
          <h3 class="text-lg font-semibold text-gray-900 mb-4">Filters</h3>
          
          <!-- Categories Filter -->
          <div class="mb-6">
            <h4 class="text-sm font-medium text-gray-900 mb-3">Categories</h4>
            <div class="space-y-2">
              <div *ngFor="let category of categories" class="flex items-center">
                <p-checkbox 
                    [inputId]="'cat-' + category.name" 
                    name="categories" 
                    [value]="category.name" 
                    [(ngModel)]="selectedCategory" 
                    (onChange)="onFilterChange()">
                  </p-checkbox>
                <label [for]="'cat-' + category.name" class="ml-2 text-sm text-gray-700 cursor-pointer">
                  {{ category.name }}
                </label>
              </div>
            </div>
          </div>

          <!-- Price Range Filter -->
          <div class="mb-6">
            <h4 class="text-sm font-medium text-gray-900 mb-3">Price Range</h4>
            <div class="px-2">
              <p-slider 
                [(ngModel)]="priceRange" 
                [range]="true" 
                [min]="0" 
                [max]="1000" 
                [step]="10"
                (onSlideEnd)="onFilterChange()">
              </p-slider>
              <div class="flex justify-between text-xs text-gray-500 mt-2">
                <span>${{ priceRange[0] }}</span>
                <span>${{ priceRange[1] }}</span>
              </div>
            </div>
          </div>

          <!-- Brand Filter -->
          <div class="mb-6">
            <h4 class="text-sm font-medium text-gray-900 mb-3">Brands</h4>
            <div class="space-y-2">
              <div *ngFor="let brand of brands" class="flex items-center">
                <p-checkbox 
                  [inputId]="'brand-' + brand" 
                  name="brands" 
                  [value]="brand" 
                  [(ngModel)]="selectedBrands" 
                  (onChange)="onFilterChange()">
                </p-checkbox>
                <label [for]="'brand-' + brand" class="ml-2 text-sm text-gray-700 cursor-pointer">
                  {{ brand }}
                </label>
              </div>
            </div>
          </div>

          <!-- Rating Filter -->
          <div class="mb-6">
            <h4 class="text-sm font-medium text-gray-900 mb-3">Rating</h4>
            <div class="space-y-2">
              <div *ngFor="let rating of ratingOptions" class="flex items-center">
                <p-radioButton 
                  [(ngModel)]="selectedRating" 
                  [value]="rating"
                  [inputId]="'rating-' + rating"
                  (onClick)="onFilterChange()">
                </p-radioButton>
                <label [for]="'rating-' + rating" class="ml-2 text-sm text-gray-700 cursor-pointer flex items-center">
                  <p-rating 
                    [ngModel]="rating" 
                    [readonly]="true" 
                    [cancel]="false"
                    styleClass="text-xs">
                  </p-rating>
                  <span class="ml-1">& up</span>
                </label>
              </div>
            </div>
          </div>

          <!-- Clear Filters -->
          <p-button 
            label="Clear All Filters" 
            icon="pi pi-times" 
            (onClick)="clearFilters()"
            [outlined]="true"
            styleClass="w-full p-button-sm">
          </p-button>
        </div>
      </div>

      <!-- Products Grid -->
      <div class="lg:col-span-3">
        <!-- Results Info -->
        <div class="flex items-center justify-between mb-6">
          <p class="text-sm text-gray-600">
            Showing {{ (currentPage - 1) * pageSize + 1 }}-{{ Math.min(currentPage * pageSize, totalProducts) }} of {{ totalProducts }} results
          </p>
          <div class="flex items-center gap-2">
            <span class="text-sm text-gray-600">View:</span>
            <p-button 
              icon="pi pi-th-large" 
              [outlined]="viewMode !== 'grid'"
              (onClick)="setViewMode('grid')"
              styleClass="p-button-sm">
            </p-button>
            <p-button 
              icon="pi pi-list" 
              [outlined]="viewMode !== 'list'"
              (onClick)="setViewMode('list')"
              styleClass="p-button-sm">
            </p-button>
          </div>
        </div>

        <!-- Loading State -->
        <div *ngIf="loading" class="flex justify-center py-12">
          <p-progressSpinner></p-progressSpinner>
        </div>

        <!-- Products Grid View -->
        <div *ngIf="!loading && viewMode === 'grid'" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
          <div *ngFor="let product of filteredProducts" class="group">
            <p-card styleClass="h-full hover:shadow-lg transition-shadow duration-300">
              <ng-template pTemplate="header">
                <div class="relative overflow-hidden">
                  <img 
                    [src]="product.imageUrl" 
                    [alt]="product.name"
                    class="w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300"
                    (error)="onImageError($event)">
                  <div *ngIf="product.badge" class="absolute top-2 left-2">
                    <p-tag 
                      [value]="product.badge" 
                      [severity]="getBadgeSeverity(product.badge)"
                      styleClass="text-xs">
                    </p-tag>
                  </div>
                  <div class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                    <p-button 
                      icon="pi pi-heart" 
                      [outlined]="true"
                      styleClass="p-button-sm p-button-rounded bg-white"
                      (onClick)="toggleWishlist(product)">
                    </p-button>
                  </div>
                </div>
              </ng-template>
              
              <div class="p-4">
                <h3 class="text-lg font-semibold text-gray-900 mb-2 line-clamp-2">
                  <a [routerLink]="['/products', product.id]" class="hover:text-primary-600 transition-colors">
                    {{ product.name }}
                  </a>
                </h3>
                
                <div class="flex items-center gap-2 mb-3">
                  <p-rating 
                    [ngModel]="product.rating" 
                    [readonly]="true" 
                    [cancel]="false"
                    styleClass="text-sm">
                  </p-rating>
                  <span class="text-sm text-gray-500">({{ product.reviews }})</span>
                </div>
                
                <div class="flex items-center justify-between">
                  <div class="flex items-center gap-2">
                    <span class="text-xl font-bold text-gray-900">{{ '$' + product.price }}</span>
                    <span *ngIf="product.originalPrice" class="text-sm text-gray-500 line-through">
                      {{ '$' + product.originalPrice }}
                    </span>
                  </div>
                  <p-button 
                    icon="pi pi-shopping-cart" 
                    label="Add to Cart"
                    (onClick)="addToCart(product)"
                    styleClass="p-button-sm">
                  </p-button>
                </div>
              </div>
            </p-card>
          </div>
        </div>

        <!-- Products List View -->
        <div *ngIf="!loading && viewMode === 'list'" class="space-y-4">
          <div *ngFor="let product of filteredProducts">
            <p-card styleClass="hover:shadow-lg transition-shadow duration-300">
              <div class="flex gap-4">
                <div class="relative flex-shrink-0">
                  <img 
                    [src]="product.imageUrl" 
                    [alt]="product.name"
                    class="w-32 h-32 object-cover rounded"
                    (error)="onImageError($event)">
                  <div *ngIf="product.badge" class="absolute top-2 left-2">
                    <p-tag 
                      [value]="product.badge" 
                      [severity]="getBadgeSeverity(product.badge)"
                      styleClass="text-xs">
                    </p-tag>
                  </div>
                </div>
                
                <div class="flex-1">
                  <h3 class="text-xl font-semibold text-gray-900 mb-2">
                    <a [routerLink]="['/products', product.id]" class="hover:text-primary-600 transition-colors">
                      {{ product.name }}
                    </a>
                  </h3>
                  
                  <div class="flex items-center gap-2 mb-3">
                    <p-rating 
                      [ngModel]="product.rating" 
                      [readonly]="true" 
                      [cancel]="false">
                    </p-rating>
                    <span class="text-sm text-gray-500">({{ product.reviews }} reviews)</span>
                  </div>
                  
                  <p class="text-gray-600 mb-4 line-clamp-2">{{ product.description }}</p>
                  
                  <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                      <span class="text-2xl font-bold text-gray-900">{{ '$' + product.price }}</span>
                      <span *ngIf="product.originalPrice" class="text-lg text-gray-500 line-through">
                        {{ '$' + product.originalPrice }}
                      </span>
                    </div>
                    <div class="flex items-center gap-2">
                      <p-button 
                        icon="pi pi-heart" 
                        [outlined]="true"
                        (onClick)="toggleWishlist(product)"
                        styleClass="p-button-sm">
                      </p-button>
                      <p-button 
                        icon="pi pi-shopping-cart" 
                        label="Add to Cart"
                        (onClick)="addToCart(product)"
                        styleClass="p-button-sm">
                      </p-button>
                    </div>
                  </div>
                </div>
              </div>
            </p-card>
          </div>
        </div>

        <!-- Empty State -->
        <div *ngIf="!loading && filteredProducts.length === 0" class="text-center py-12">
          <i class="pi pi-search text-4xl text-gray-400 mb-4"></i>
          <h3 class="text-xl font-semibold text-gray-900 mb-2">No products found</h3>
          <p class="text-gray-600 mb-4">Try adjusting your filters or search criteria</p>
          <p-button 
            label="Clear Filters" 
            icon="pi pi-times" 
            (onClick)="clearFilters()"
            [outlined]="true">
          </p-button>
        </div>

        <!-- Pagination -->
        <div *ngIf="!loading && filteredProducts.length > 0" class="mt-8">
          <p-paginator 
            [rows]="itemsPerPage" 
            [totalRecords]="totalItems"
            [first]="(currentPage - 1) * itemsPerPage"
            (onPageChange)="onPageChange($event)"
            [showCurrentPageReport]="true"
            currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries">
          </p-paginator>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Toast Messages -->
<p-toast></p-toast>